{% extends 'gramm/base.html' %}
{% load thumbnail %}

{% block content %}
<hr>
{% include 'gramm/pagination.html' %}

{% for post in posts %}
<hr>
<div class="post">
    <h3>{{ post.author.username }}</h3>

{% if user.is_authenticated and post.author != user %}
<form method="post" action="{% url 'follow_user' %}">
    {% csrf_token %}
    <input type="hidden" name="author_id" value="{{ post.author.id }}">
    <button type="submit">
        {% if existing_follow %}
            Unfollow
        {% else %}
            Follow
        {% endif %}
    </button>
</form>
{% endif %}


    <p>{{ post.creation_date }}</p>
    <hr>

    {% for image in post.images.all %}
    <a href="{{ image.image.url }}">
        <img src="{% thumbnail image.image 300x300 %}" alt="Image">
    </a>
    {% endfor %}
    <br>

    <p>Tags: {% for tag in post.tags.all %}#{{ tag }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>

    <p>{{ post.author.username }} - {{ post.likes.count }} likes</p>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'like_post' %}">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="{{ post.id }}">
        <button type="submit">
            {% if request.user in post.likes.all %}
            Unlike
            {% else %}
            Like
            {% endif %}
        </button>
    </form>
    {% endif %}
</div>
{% endfor %}
<hr>
{% include 'gramm/pagination.html' %}
<hr>
{% endblock %}
